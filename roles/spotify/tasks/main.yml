---
# roles/spotify/tasks/main.yml

- name: Install Spotify on macOS
  homebrew:
    name: spotify
    state: present
    install_options: cask
  when: ansible_facts['os_family'] == 'Darwin'

- name: Add Spotify GPG key (Linux)
  ansible.builtin.apt_key:
    url: https://download.spotify.com/debian/pubkey_C85668DF69375001.gpg
    state: present
    keyring: /etc/apt/trusted.gpg.d/spotify.gpg
  when: ansible_facts['os_family'] == 'Debian'

- name: Add Spotify APT repository (Linux)
  apt_repository:
    repo: "deb https://repository.spotify.com stable non-free"
    state: present
    filename: spotify
  when: ansible_facts['os_family'] == 'Debian'

- name: Install Spotify (Linux)
  apt:
    name: spotify-client
    state: present
    update_cache: yes
  when: ansible_facts['os_family'] == 'Debian' and ansible_architecture == 'x86_64'

- name: Log warning for unsupported platforms
  debug:
    msg: "Spotify installation is not supported on this OS."
  when: ansible_facts['os_family'] not in ['Debian', 'Darwin']
